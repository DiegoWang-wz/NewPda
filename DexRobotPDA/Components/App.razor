<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <base href="/" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
  <link href="@Assets["_content/MudBlazor/MudBlazor.min.css"]" rel="stylesheet" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <HeadOutlet @rendermode="InteractiveServer" />
</head>

<body>
<Routes @rendermode="InteractiveServer" />

<script src="_framework/blazor.web.js"></script>
<script src="@Assets["_content/MudBlazor/MudBlazor.min.js"]"></script>
<script src="js/barcode-scanner.js"></script>
<script src="js/enterKeyHandler.js"></script>
<script src="js/input-utils.js"></script>

<script src="/xlsx/dist/xlsx.full.min.js"></script>
<script>
  window.excel = {
    export: function (fileName, rows) {
      if (!Array.isArray(rows) || rows.length === 0) {
        alert('没有可导出的数据');
        return;
      }
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.json_to_sheet(rows, { skipHeader: false });

      const headers = Object.keys(rows[0]);
      const colWidths = headers.map(h => {
        const maxLen = Math.max(
          h.length,
          ...rows.map(r => (r[h] == null ? 1 : String(r[h]).length))
        );
        return { wch: maxLen + 2 };
      });
      ws['!cols'] = colWidths;

      XLSX.utils.book_append_sheet(wb, ws, 'Logs');
      XLSX.writeFile(wb, fileName || 'Logs.xlsx');
    }
  };
</script>
</body>
</html>
