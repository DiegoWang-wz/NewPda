<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <base href="/" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
  <link href="@Assets["_content/MudBlazor/MudBlazor.min.css"]" rel="stylesheet" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <HeadOutlet @rendermode="InteractiveServer" />
</head>

<body>
<Routes @rendermode="InteractiveServer" />

<script src="_framework/blazor.web.js"></script>
<script src="@Assets["_content/MudBlazor/MudBlazor.min.js"]"></script>
<script src="js/barcode-scanner.js"></script>
<script src="js/enterKeyHandler.js"></script>
<script src="js/input-utils.js"></script>

<script src="/xlsx/dist/xlsx.full.min.js"></script>
<script>
  window.excel = window.excel || {};

  // 把后端传来的 base64 保存为 .xlsx
  window.excel.saveBase64 = function (fileName, base64) {
    const binary = atob(base64);
    const len = binary.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);
    const blob = new Blob([bytes], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = fileName || '任务报告.xlsx';
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
  };
</script>
<script>
  window.excel = window.excel || {};

  window.excel.showLoading = function (message) {
    const id = 'export-loading';
    if (document.getElementById(id)) return;
    const div = document.createElement('div');
    div.id = id;
    div.style.cssText = `
      position: fixed; inset: 0; display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.35); z-index: 99999;
    `;
    div.innerHTML = `<div style="
      background:#222;color:#fff;padding:14px 18px;border-radius:8px;min-width:200px;
      text-align:center;font-size:14px;">${message || '正在导出...'}</div>`;
    document.body.appendChild(div);
  };

  window.excel.hideLoading = function () {
    const el = document.getElementById('export-loading');
    if (el) el.remove();
  };
</script>

</body>
</html>
